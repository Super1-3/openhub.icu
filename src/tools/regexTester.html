<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>正则测试实验室 - OpenHub</title>
    <meta name="description" content="可视化正则表达式匹配与调试工具。内置常用正则模板，支持实时匹配预览与捕获组分析。">
    <link rel="icon" type="image/svg+xml" href="../../favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Highlight Styles */
        .highlight { background-color: #e0e7ff; border-radius: 2px; box-shadow: 0 0 0 1px #c7d2fe; }
        .highlight-current { background-color: #818cf8; color: white; box-shadow: none; }
        .highlight-group { background-color: #fef3c7; border-bottom: 2px solid #f59e0b; }
        
        /* Line Numbers */
        .line-numbers {
            user-select: none;
            text-align: right;
            color: #9ca3af;
            padding-right: 0.5rem;
            border-right: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 z-10 shrink-0">
        <div class="px-4 sm:px-6 lg:px-8 h-14 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <a href="../../index.html" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
                    <div class="w-7 h-7 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-md flex items-center justify-center text-white font-bold shadow-sm text-sm">
                        O
                    </div>
                    <span class="hidden sm:inline font-bold text-lg tracking-tight text-gray-900">OpenHub<span class="text-indigo-600">.icu</span></span>
                </a>
                <span class="text-gray-300 mx-2">/</span>
                <span class="text-gray-600 font-medium text-sm">正则实验室</span>
            </div>
        </div>
    </header>

    <!-- Toolbar -->
    <div class="bg-white border-b border-gray-200 px-4 py-2 flex items-center gap-2 shrink-0 z-20 overflow-x-auto whitespace-nowrap">
        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider mr-2">常用模板:</span>
        <button onclick="setRegex('Email', '[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}', 'g')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">Email</button>
        <button onclick="setRegex('Phone', '1[3-9]\\d{9}', 'g')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">手机号</button>
        <button onclick="setRegex('URL', 'https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)', 'gi')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">URL</button>
        <button onclick="setRegex('Date', '\\d{4}-\\d{2}-\\d{2}', 'g')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">日期</button>
        <button onclick="setRegex('ID Card', '[1-9]\\d{5}(18|19|20|21)\\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\\d{3}[0-9Xx]', 'g')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">身份证</button>
        <button onclick="setRegex('Chinese', '[\\u4e00-\\u9fa5]', 'g')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">中文</button>
        <button onclick="setRegex('IPv4', '((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)', 'g')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">IPv4</button>
        <button onclick="setRegex('QQ', '[1-9][0-9]{4,10}', 'g')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">QQ号</button>
        <button onclick="setRegex('Postal Code', '[1-9]\\d{5}', 'g')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">邮政编码</button>
        <button onclick="setRegex('Hex Color', '#(?:[0-9a-fA-F]{3}){1,2}\\b', 'g')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">Hex颜色</button>
        <button onclick="setRegex('Time', '(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d', 'g')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">时间</button>
        <button onclick="setRegex('HTML Tag', '<[^>]+>', 'g')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">HTML标签</button>
        <button onclick="setRegex('Strong Password', '(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)[a-zA-Z\\d!@#$%^&*]{8,}', 'g')" class="px-3 py-1.5 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 transition-all">强密码</button>
    </div>

    <!-- Regex Input Area -->
    <div class="bg-white border-b border-gray-200 p-4 shrink-0 shadow-sm z-10">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row gap-4 items-center">
            <div class="relative flex-grow w-full">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400 font-mono font-bold text-lg">
                    /
                </div>
                <input type="text" id="regexInput" 
                    class="block w-full pl-8 pr-12 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 font-mono text-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 focus:bg-white transition-all shadow-sm" 
                    placeholder="在此输入正则表达式..." 
                    value="[a-zA-Z]+"
                    autocomplete="off">
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-400 font-mono font-bold text-lg">
                    /
                </div>
            </div>
            
            <div class="flex items-center gap-2 bg-gray-50 p-1.5 rounded-lg border border-gray-200 shrink-0">
                <label class="cursor-pointer select-none px-2 py-1.5 rounded-md hover:bg-white hover:shadow-sm text-sm font-medium text-gray-600 transition-all flex items-center gap-1">
                    <input type="checkbox" id="flag-g" class="accent-indigo-600" checked>
                    <span>g</span>
                </label>
                <label class="cursor-pointer select-none px-2 py-1.5 rounded-md hover:bg-white hover:shadow-sm text-sm font-medium text-gray-600 transition-all flex items-center gap-1">
                    <input type="checkbox" id="flag-i" class="accent-indigo-600">
                    <span>i</span>
                </label>
                <label class="cursor-pointer select-none px-2 py-1.5 rounded-md hover:bg-white hover:shadow-sm text-sm font-medium text-gray-600 transition-all flex items-center gap-1">
                    <input type="checkbox" id="flag-m" class="accent-indigo-600">
                    <span>m</span>
                </label>
                 <label class="cursor-pointer select-none px-2 py-1.5 rounded-md hover:bg-white hover:shadow-sm text-sm font-medium text-gray-600 transition-all flex items-center gap-1">
                    <input type="checkbox" id="flag-s" class="accent-indigo-600">
                    <span>s</span>
                </label>
            </div>
        </div>
        <div id="regexError" class="text-red-500 text-xs mt-2 font-mono hidden max-w-7xl mx-auto pl-2"></div>
    </div>

    <!-- Main Split View -->
    <div class="flex-grow flex flex-col md:flex-row overflow-hidden">
        
        <!-- Left: Test String Input -->
        <div class="flex-1 flex flex-col min-h-[40%] md:min-h-0 border-b md:border-b-0 md:border-r border-gray-200 relative group bg-white">
            <div class="flex items-center justify-between px-4 py-2 bg-gray-50 border-b border-gray-100">
                <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">测试文本</h3>
                <div class="flex items-center gap-2">
                     <button onclick="clearText()" class="text-xs text-gray-400 hover:text-red-500 transition-colors">清空</button>
                </div>
            </div>
            <textarea id="testInput" 
                class="flex-1 p-4 resize-none focus:outline-none font-mono text-sm leading-relaxed text-gray-800 bg-white w-full" 
                placeholder="在此输入需要匹配的文本内容..." 
                spellcheck="false">Hello OpenHub! This is a test string.
Email: support@openhub.icu
Phone: 13800138000
URL: https://www.openhub.icu/tools
Date: 2024-12-31
Time: 23:59:59
IDCard: 11010119900307123X
Mark: 正则表达式测试 (Chinese)
IPV4: 192.168.1.1
QQ: 10001
Postal Code: 100000
Hex Color: #FF5733
HTML Tag: <div class="container">Content</div>
Strong Password: MySecurePass123!</textarea>
        </div>

        <!-- Right: Match Results -->
        <div class="flex-1 flex flex-col min-h-[60%] md:min-h-0 bg-gray-50 relative overflow-hidden">
            <div class="flex items-center justify-between px-4 py-2 bg-gray-100 border-b border-gray-200">
                <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">匹配结果</h3>
                <span id="matchCount" class="text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-full border border-indigo-100">0 匹配</span>
            </div>
            
            <div class="flex-1 overflow-auto p-4" id="resultsContainer">
                <!-- Highlighted Text View -->
                <div id="highlightView" class="font-mono text-sm leading-relaxed whitespace-pre-wrap break-words bg-white p-4 rounded-xl border border-gray-200 shadow-sm min-h-[100px] mb-4"></div>
                
                <!-- Match Details -->
                <div id="matchDetails" class="space-y-3">
                    <!-- Matches will be inserted here -->
                </div>
            </div>
        </div>

    </div>

    <script>
        const regexInput = document.getElementById('regexInput');
        const testInput = document.getElementById('testInput');
        const highlightView = document.getElementById('highlightView');
        const matchDetails = document.getElementById('matchDetails');
        const matchCount = document.getElementById('matchCount');
        const regexError = document.getElementById('regexError');
        const flags = ['g', 'i', 'm', 's'];
        
        const flagInputs = {};
        flags.forEach(f => {
            flagInputs[f] = document.getElementById('flag-' + f);
            flagInputs[f].addEventListener('change', update);
        });

        regexInput.addEventListener('input', update);
        testInput.addEventListener('input', update);

        function setRegex(name, pattern, flagStr) {
            regexInput.value = pattern;
            flags.forEach(f => {
                flagInputs[f].checked = flagStr.includes(f);
            });
            update();
        }
        
        function clearText() {
            testInput.value = '';
            update();
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        function update() {
            const pattern = regexInput.value;
            const text = testInput.value;
            let currentFlags = '';
            flags.forEach(f => {
                if (flagInputs[f].checked) currentFlags += f;
            });

            if (!pattern) {
                highlightView.textContent = text;
                matchDetails.innerHTML = '';
                matchCount.textContent = '0 匹配';
                regexError.classList.add('hidden');
                return;
            }

            try {
                const regex = new RegExp(pattern, currentFlags);
                regexError.classList.add('hidden');
                regexInput.classList.remove('border-red-500', 'focus:ring-red-500', 'focus:border-red-500');
                
                let matches = [];
                let match;
                
                // Prevent infinite loop if empty match
                if (pattern === '') return;

                // Clone regex for execution loop to not mess with state if 'g' is missing but we want to simulate or check
                // Actually if 'g' is not present, exec only returns first match repeatedly.
                
                if (currentFlags.includes('g')) {
                    let lastIndex = 0;
                    while ((match = regex.exec(text)) !== null) {
                        matches.push(match);
                        if (match.index === regex.lastIndex) {
                            regex.lastIndex++; // Avoid infinite loop with zero-width matches
                        }
                    }
                } else {
                    match = regex.exec(text);
                    if (match) matches.push(match);
                }

                renderResults(text, matches);

            } catch (e) {
                regexError.textContent = e.message;
                regexError.classList.remove('hidden');
                regexInput.classList.add('border-red-500', 'focus:ring-red-500', 'focus:border-red-500');
                highlightView.textContent = text;
                matchDetails.innerHTML = '';
                matchCount.textContent = '错误';
            }
        }

        function renderResults(text, matches) {
            matchCount.textContent = matches.length + ' 匹配';
            
            // 1. Render Highlighted Text
            let html = '';
            let lastIndex = 0;
            
            matches.forEach((match, index) => {
                const start = match.index;
                const end = start + match[0].length;
                
                // Text before match
                html += escapeHtml(text.substring(lastIndex, start));
                
                // Match
                html += `<span class="highlight text-indigo-700 font-medium" title="Match ${index + 1}">` + escapeHtml(match[0]) + `</span>`;
                
                lastIndex = end;
            });
            
            html += escapeHtml(text.substring(lastIndex));
            highlightView.innerHTML = html;

            // 2. Render Details List
            if (matches.length === 0) {
                matchDetails.innerHTML = '<div class="text-center text-gray-400 py-8">无匹配结果</div>';
                return;
            }

            matchDetails.innerHTML = matches.map((match, i) => {
                let groupsHtml = '';
                if (match.length > 1) {
                    groupsHtml = '<div class="mt-2 space-y-1">';
                    for (let j = 1; j < match.length; j++) {
                        if (match[j] !== undefined) {
                            groupsHtml += `
                                <div class="flex items-start gap-2 text-xs">
                                    <span class="font-mono text-indigo-500 font-semibold">Group ${j}:</span>
                                    <span class="font-mono text-gray-700 bg-indigo-50 px-1 rounded break-all">${escapeHtml(match[j])}</span>
                                </div>`;
                        }
                    }
                    groupsHtml += '</div>';
                }

                return `
                    <div class="bg-white p-3 rounded-lg border border-gray-200 shadow-sm hover:border-indigo-300 transition-colors">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-xs font-bold text-white bg-indigo-500 px-1.5 py-0.5 rounded">#${i + 1}</span>
                            <span class="text-xs text-gray-400 font-mono">Index: ${match.index} - ${match.index + match[0].length}</span>
                        </div>
                        <div class="font-mono text-sm text-gray-800 break-all bg-gray-50 p-2 rounded border border-gray-100 mt-1">${escapeHtml(match[0])}</div>
                        ${groupsHtml}
                    </div>
                `;
            }).join('');
        }

        // Initialize
        update();
    </script>
</body>
</html>